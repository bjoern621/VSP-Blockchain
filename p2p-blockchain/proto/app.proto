// External API for local system communication.
// This service provides an interface for external software on the local device
// to interact with the p2p-blockchain node.
// 
// Note: This is different from the netzwerkrouting RPC which handles
// peer-to-peer communication between nodes in the network.

syntax="proto3";

package app;

import "google/protobuf/struct.proto";
import "google/protobuf/empty.proto";

option go_package = "./internal/pb";

// AppService provides an interface for external local systems to interact with the node.
service AppService {
    // ConnectTo instructs the node to establish a connection to a peer at the given address.
    //
    // Post-conditions:
    //  - Node attempts to connect to the specified peer.
    //  - Returns success/failure status.
    rpc ConnectTo(ConnectToRequest) returns (ConnectToResponse);

    // Disconnect instructs the node to disconnect from a peer.
    //
    // Post-conditions:
    //  - Node disconnects from the specified peer.
    //  - Returns success/failure status.
    rpc Disconnect(DisconnectRequest) returns (DisconnectResponse);

    // GetInternalPeerInfo returns the current internal state per peer for debugging purposes.
    rpc GetInternalPeerInfo(GetInternalPeerInfoRequest) returns (GetInternalPeerInfoResponse);

    // QueryRegistry queries the DNS seed registry for available peer addresses.
    //
    // Post-conditions:
    //  - Returns a list of peer addresses from the DNS seed.
    rpc QueryRegistry(QueryRegistryRequest) returns (QueryRegistryResponse);

    // GenerateKeyset Generates a completely new Keyset with a new random private Key
    rpc GenerateKeyset(google.protobuf.Empty) returns (GenerateKeysetResponse);

    // GetKeysetFromWIF Gets the complete keyset from the WIF encoded private key
    rpc GetKeysetFromWIF (GetKeysetFromWIFRequest) returns (GetKeysetFromWIFResponse);
}

message ConnectToRequest {
    // IP address of the peer to connect to (IPv4 or IPv6).
    bytes ip_address = 1;
    // Domain layer: uint16
    uint32 port = 2;
}

message ConnectToResponse {
    bool success = 1;
    string error_message = 2;
}

message DisconnectRequest {
    // IP address of the peer to disconnect from (IPv4 or IPv6).
    bytes ip_address = 1;
    // Domain layer: uint16
    uint32 port = 2;
}

message DisconnectResponse {
    bool success = 1;
    string error_message = 2;
}

message GetInternalPeerInfoRequest {}

message GetInternalPeerInfoResponse {
    repeated InternalPeerInfoEntry entries = 1;
}

message InternalPeerInfoEntry {
    string peer_id = 1;

    // Infrastructure data as a JSON object.
    // Uses google.protobuf.Struct which automatically serializes to native JSON.
    google.protobuf.Struct infrastructure_data = 2;
    
    // Domain-Peer information
    string version = 3; // Protocol version string
    repeated string supported_services = 4;
    string connection_state = 5;
    string direction = 6;
}

message QueryRegistryRequest {
    // The DNS hostname to query for peer addresses.
    string hostname = 1;
}

message QueryRegistryResponse {
    // List of peer addresses returned from the DNS query.
    repeated RegistryEntry entries = 1;
}

message RegistryEntry {
    // IP address of the peer.
    string ip_address = 1;
    // Peer ID assigned to this discovered peer.
    string peer_id = 2;
}

message Keyset{
  bytes private_key = 1;
  string private_key_wif = 2;
  bytes public_key = 3;
  string VSAddress = 4;
}

message GenerateKeysetResponse{
  Keyset keyset = 1;
}

message GetKeysetFromWIFRequest{
  string private_key_wif = 1;
}

message GetKeysetFromWIFResponse{
  Keyset keyset = 1;
}
