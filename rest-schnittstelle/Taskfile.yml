version: "3"

vars:
    DOCKER_TAG: latest

tasks:
    tidy:
        internal: true
        desc: Run go mod tidy
        cmds:
            - go mod tidy

    vendor:
        internal: true
        desc: Run go mod vendor
        cmds:
            - go mod vendor

    proto:
        desc: Generate gRPC code from shared .proto files
        cmds:
            - protoc --proto_path=../proto --go_out=. --go-grpc_out=. ../proto/*.proto

    prepare:
        internal: true
        desc: Prepare the module for build
        cmds:
            - task: tidy
            - task: vendor
            - task: proto

    build:
        desc: Build the docker image for rest-api
        cmds:
            - task: prepare
            - docker build -t vsp-blockchain/rest-api:{{.DOCKER_TAG}} .
