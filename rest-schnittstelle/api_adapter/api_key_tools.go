/*
 * V$-GOIN API
 *
 * This is the official API for the interaction with the VS-Blockchain. This API focuses on payment-related use cases in the most easy and feasible way. All relevant keys and parameters are documented directly within the schema definitions.
 *
 * API version: 1.0.0
 * Base Generated by: OpenAPI Generator (https://openapi-generator.tech)
 */

package api_adapter

import (
	"errors"
	"s3b/vsp-blockchain/rest-api/internal/common"
	"s3b/vsp-blockchain/rest-api/konto"

	"github.com/gin-gonic/gin"
)

type KeyToolsAPI struct {
	keyGenerator konto.KeyGenerator
}

func NewKeyToolsAPI(keyGenerator konto.KeyGenerator) *KeyToolsAPI {
	return &KeyToolsAPI{
		keyGenerator: keyGenerator,
	}
}

// Get /address
// Returns the V$Address to a corresponding private key.
func (api *KeyToolsAPI) AddressGet(c *gin.Context) {
	// Your handler implementation
	keyset, err := api.keyGenerator.GetKeysetFromWIF(c.GetHeader("privateKeyWIF"))

	if err != nil {
		if errors.Is(err, common.ErrWIFInput) {
			c.JSON(400, gin.H{
				"error": err.Error(),
			})
			return
		}

		if errors.Is(err, common.ErrServer) {
			c.JSON(500, gin.H{
				"error": err.Error(),
			})
			return
		}

		c.JSON(500, gin.H{
			"error": "unknown error",
		})
		return

	}

	response := AddressGet200Response{
		VSAddress: keyset.VSAddress,
	}

	c.JSON(200, response)
}

// Get /address/new
// Returns a new V$Address with the corresponding private key.
func (api *KeyToolsAPI) AddressNewGet(c *gin.Context) {
	keyset, err := api.keyGenerator.GenerateKeyset()

	if err != nil {
		if errors.Is(err, common.ErrServer) {
			c.JSON(500, gin.H{
				"error": err.Error(),
			})
			return
		}
		c.JSON(500, gin.H{
			"error": "unknown error",
		})
		return

	}

	response := AddressNewGet200Response{
		NewPrivateKeyWIF: keyset.PrivateKeyWif,
		NewVSAddress:     keyset.VSAddress,
	}

	c.JSON(200, response)
}
